[
    {
        "$match": {
            "updatedAt": {
                "$gte": "{{ prev_data_interval_start_success }}",
                "$lte": "{{ data_interval_end }}"
            }
        }
    },
    { "$unwind": "$items" },
    {
        "$replaceRoot": {
            "newRoot": {
                "$mergeObjects": [
                  {
                    "order_id": "$_id"
                  },
                  "$items"
                ]
            }
        }
    },
    { "$set": {
        "id": "$_id",
        "discount": {
                "$convert": {
                    "input": "$discount",
                    "to": "int",
                    "onError": 0,
                    "onNull": 0
                }
            }
      }
    },
    {
        "$project": {
            "items": 0,
            "_id": 0,
            "request_detail": 0
        }
    },
    { "$skip": 0 },
    { "$limit": 5000}
]
