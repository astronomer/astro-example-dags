[
    {
        "$match": {
            "updatedAt": {
                "$gte": "{{ prev_data_interval_start_success }}",
                "$lte": "{{ data_interval_end }}"
            }
        }
    },
    {
        "$set": {
            "id": "$_id",
            "subtotal_price": {
                "$cond": {
                    "if": { "$in": ["$subtotal_price", ["", " "]] },
                    "then": null,
                    "else": {
                        "$cond": {
                            "if": { "$eq": [{ "$type": "$subtotal_price" }, "string"] },
                            "then": { "$toDouble": "$subtotal_price" },
                            "else": "$subtotal_price"
                        }
                    }
                }
            }
        }
    },
    {
        "$project": {
            "items": 0,
            "original_items": 0,
            "items_available": 0,
            "items_not_available": 0,
            "items_original_order": 0,
            "appointments": 0,
            "deleted_appointments": 0,
            "zettle_payment_references": 0,
            "possible_delivery_fees": 0,
            "notes": 0,
            "request_detail": 0,
            "request_detail_items": 0,
            "order_changes_log": 0,
            "platform_order_creation_response": 0,
            "_id": 0
        }
    },
    { "$skip": 0 },
    { "$limit": 5000}
]
