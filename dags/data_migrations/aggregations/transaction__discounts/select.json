[
    {
        "$match": {
            "updatedAt": {
                "$gte": "{{ prev_data_interval_start_success }}",
                "$lte": "{{ data_interval_end }}"
            }
        }
    },
    {
        "$unwind": {
            "path": "$discounts",
            "includeArrayIndex": "arrayIndex"
        }
    },
    {
        "$set": {
            "transaction_id": "$_id",
            "transactionitem_id": "$discounts",
            "id": {
                "$concat": [
                  {"$toString": "$_id"},
                  "__",
                  {"$toString": "$arrayIndex"}
                ]
            }
        }
    },
    {
        "$project": {
            "transactionitem_id": 1,
            "transaction_id": 1,
            "id":1,
            "_id":0
        }
    },
    { "$skip": 0 },
    { "$limit": 5000}
]
